(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const l=320,c=180,E=900,p=1e3,y=115,L=.8,f=[{x:0,y:164,w:320,h:16},{x:52,y:128,w:72,h:10},{x:160,y:102,w:62,h:10},{x:250,y:138,w:56,h:10}];class b{canvas;ctx;input;lastTick=0;isRunning=!1;player={x:16,y:40,w:16,h:16,vx:0,vy:0,facing:1,grounded:!1,animationTime:0};constructor(t,e){const i=t.getContext("2d");if(!i)throw new Error("2D context unavailable");this.canvas=t,this.ctx=i,this.input=e,this.ctx.imageSmoothingEnabled=!1,this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}start(){this.isRunning||(this.isRunning=!0,this.lastTick=performance.now(),requestAnimationFrame(t=>this.loop(t)))}loop(t){if(!this.isRunning)return;const e=Math.min((t-this.lastTick)/1e3,1/30);this.lastTick=t,this.update(e),this.render(),this.input.endFrame(),requestAnimationFrame(i=>this.loop(i))}update(t){const e=this.input.state;e.left&&!e.right?(this.player.vx-=p*t,this.player.facing=-1):e.right&&!e.left?(this.player.vx+=p*t,this.player.facing=1):this.player.grounded&&(this.player.vx*=L),this.player.vx=T(this.player.vx,-y,y),this.player.grounded&&this.input.consumeJumpPressed()&&(this.player.vy=-320,this.player.grounded=!1),this.player.vy+=E*t,this.moveHorizontal(t),this.moveVertical(t),this.player.animationTime+=t}moveHorizontal(t){this.player.x+=this.player.vx*t;for(const e of f)m(this.player,e)&&(this.player.vx>0?this.player.x=e.x-this.player.w:this.player.vx<0&&(this.player.x=e.x+e.w),this.player.vx=0)}moveVertical(t){this.player.y+=this.player.vy*t,this.player.grounded=!1;for(const e of f)m(this.player,e)&&(this.player.vy>0?(this.player.y=e.y-this.player.h,this.player.grounded=!0):this.player.vy<0&&(this.player.y=e.y+e.h),this.player.vy=0)}render(){this.ctx.imageSmoothingEnabled=!1,this.ctx.clearRect(0,0,l,c),this.ctx.fillStyle="#8bd3ff",this.ctx.fillRect(0,0,l,c),this.ctx.fillStyle="#669f5d";for(const t of f)this.ctx.fillRect(t.x,t.y,t.w,t.h);this.drawPlayer(),this.drawHud()}drawPlayer(){this.ctx.save(),this.player.facing===-1?(this.ctx.translate(this.player.x+this.player.w,this.player.y),this.ctx.scale(-1,1)):this.ctx.translate(this.player.x,this.player.y),this.ctx.fillStyle="#2f4f6f",this.ctx.fillRect(0,0,this.player.w,this.player.h),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(11,4,2,2),this.ctx.restore()}drawHud(){this.ctx.fillStyle="rgba(12, 24, 40, 0.7)",this.ctx.fillRect(6,6,84,18),this.ctx.font="10px monospace",this.ctx.fillStyle="#f7f3c5",this.ctx.fillText("HP",11,18);for(let t=0;t<3;t+=1)this.ctx.fillStyle="#da4f5d",this.ctx.fillRect(30+t*16,10,10,10),this.ctx.strokeStyle="#81252f",this.ctx.strokeRect(30+t*16,10,10,10)}resizeCanvas(){const t=window.innerWidth-24,e=window.innerHeight-150,i=Math.max(1,Math.floor(Math.min(t/l,e/c)));this.canvas.style.width=`${l*i}px`,this.canvas.style.height=`${c*i}px`}}function m(a,t){return a.x<t.x+t.w&&a.x+a.w>t.x&&a.y<t.y+t.h&&a.y+a.h>t.y}function T(a,t,e){return Math.min(e,Math.max(t,a))}const g={ArrowLeft:"left",ArrowRight:"right",ArrowDown:"dig",Space:"jumpHeld"},H=["left","right","jump","dig"];class O{state={left:!1,right:!1,jumpHeld:!1,jumpPressed:!1,dig:!1};hasConsumedJump=!1;attachKeyboard(t){t.addEventListener("keydown",e=>{const i=g[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}this.state[i]=!0}}),t.addEventListener("keyup",e=>{const i=g[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld=!1;return}this.state[i]=!1}})}attachTouchButtons(t){t.forEach(e=>{const i=e.dataset.control;if(!i||!H.includes(i))return;const s=i,r=o=>{if(o.preventDefault(),s==="jump"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}s==="left"&&(this.state.left=!0),s==="right"&&(this.state.right=!0),s==="dig"&&(this.state.dig=!0)},n=o=>{if(o.preventDefault(),s==="jump"){this.state.jumpHeld=!1;return}s==="left"&&(this.state.left=!1),s==="right"&&(this.state.right=!1),s==="dig"&&(this.state.dig=!1)};e.addEventListener("pointerdown",r),e.addEventListener("pointerup",n),e.addEventListener("pointerleave",n),e.addEventListener("pointercancel",n),e.addEventListener("contextmenu",o=>o.preventDefault())})}consumeJumpPressed(){return this.hasConsumedJump||!this.state.jumpPressed?!1:(this.hasConsumedJump=!0,!0)}endFrame(){this.state.jumpPressed=!1,this.hasConsumedJump=!1}}const x=document.querySelector("#app");if(!x)throw new Error("Missing #app container");x.innerHTML=`
  <header class="top-bar">
    <h1>Sisu: Guardian of the Garden</h1>
    <button id="soundToggle" type="button" aria-pressed="false">Sound: Off</button>
  </header>
  <main class="game-shell">
    <canvas id="gameCanvas" width="320" height="180" aria-label="Game canvas"></canvas>
    <div id="startOverlay" class="start-overlay">
      <div class="start-card">
        <h2>Sisu: Guardian of the Garden</h2>
        <p>Phase 1 Prototype</p>
        <button id="startButton" type="button">Start</button>
      </div>
    </div>
  </main>
  <footer class="mobile-controls" aria-label="Touch controls">
    <button data-control="left" type="button">Left</button>
    <button data-control="right" type="button">Right</button>
    <button data-control="jump" type="button">Jump</button>
    <button data-control="dig" type="button">Dig</button>
  </footer>
`;const v=document.querySelector("#gameCanvas"),w=document.querySelector("#startOverlay"),S=document.querySelector("#startButton"),u=document.querySelector("#soundToggle"),R=Array.from(document.querySelectorAll("[data-control]"));if(!v||!w||!S||!u)throw new Error("Missing required game UI elements");const d=new O;d.attachKeyboard(window);d.attachTouchButtons(R);const j=new b(v,d);let h=!1;u.addEventListener("click",()=>{h=!h,u.textContent=`Sound: ${h?"On":"Off"}`,u.setAttribute("aria-pressed",String(h))});S.addEventListener("click",()=>{w.classList.add("hidden"),j.start()});
