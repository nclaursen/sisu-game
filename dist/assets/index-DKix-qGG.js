(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const q=56,Z=.18,Lt={rat:{width:14,height:12,speed:q,hp:1,baseColor:"#8b2e3b",eyeColor:"#f8d7db"},mouse:{width:11,height:9,speed:q*1.4,hp:1,baseColor:"#8c5a73",eyeColor:"#f9e9f2"},tank:{width:17,height:14,speed:q*.75,hp:2,baseColor:"#4d5f72",eyeColor:"#d8e7f5"}};class Ot{type;maxHp;width;height;speed;baseColor;eyeColor;x;y;vx;vy;facing;grounded=!1;alive=!0;hp;hitStunTimerSec=0;spawnTimerSec=Z;animTimerSec=0;constructor(t){const e=Lt[t.type];this.type=t.type,this.maxHp=e.hp,this.width=e.width,this.height=e.height,this.speed=e.speed,this.baseColor=e.baseColor,this.eyeColor=e.eyeColor,this.x=t.x,this.y=t.y,this.facing=t.facing??-1,this.vx=this.speed*this.facing,this.vy=0,this.hp=this.maxHp}update(t,e,i,s,n){if(!this.alive)return;this.hitStunTimerSec>0&&(this.hitStunTimerSec=Math.max(0,this.hitStunTimerSec-t)),this.spawnTimerSec>0&&(this.spawnTimerSec=Math.max(0,this.spawnTimerSec-t)),this.animTimerSec+=t;const o=this.hitStunTimerSec<=0;if(o&&this.grounded&&!this.hasGroundAhead(e)&&this.reverseDirection(),this.vx=o?this.speed*this.facing:0,this.x+=this.vx*t,o){let a=!1;for(const l of e)et(this.getBody(),l,n)&&(a=!0,this.vx>0?this.x=l.x-this.width+n:this.vx<0&&(this.x=l.x+l.w-n));a&&(this.reverseDirection(),this.vx=this.speed*this.facing)}this.vy=Math.min(this.vy+i*t,s),this.y+=this.vy*t,this.grounded=!1;for(const a of e)et(this.getBody(),a,n)&&(this.vy>0?(this.y=a.y-this.height+n,this.grounded=!0):this.vy<0&&(this.y=a.y+a.h-n),this.vy=0)}draw(t){if(!this.alive)return;const e=this.getBody(),i=this.spawnTimerSec>0?.8+(1-this.spawnTimerSec/Z)*.2:1,s=e.x+e.w/2,n=e.y+e.h,o=e.w*i,a=e.h*i,l=s-o/2,c=n-a,d=Ht(this.type),h=Math.floor(this.animTimerSec/d.frameDuration)%2,u=this.type==="tank"&&this.hp===1?1:0;if(d.image.complete&&d.image.naturalWidth>0){const p=h*d.frameW,m=u*d.frameH;t.save(),this.facing===-1?(t.translate(l+o,c),t.scale(-1,1),t.drawImage(d.image,p,m,d.frameW,d.frameH,0,0,o,a)):t.drawImage(d.image,p,m,d.frameW,d.frameH,l,c,o,a),t.restore();return}t.save(),t.fillStyle=this.baseColor,t.fillRect(l,c,o,a),t.fillStyle=this.eyeColor,t.fillRect(l+o-3,c+3,2,2),t.restore()}canDamagePlayer(){return this.alive&&this.hitStunTimerSec<=0&&this.spawnTimerSec<=0}applyStomp(){return this.alive?(this.hp-=1,this.hitStunTimerSec=.2,this.hp<=0?(this.alive=!1,this.vx=0,this.vy=0,"killed"):"damaged"):"killed"}isAlive(){return this.alive}getBody(){return{x:this.x,y:this.y,w:this.width,h:this.height}}hasGroundAhead(t){const e=this.facing===1?this.x+this.width+2:this.x-2,i=this.y+this.height+2;return t.some(s=>{const n=e>=s.x&&e<=s.x+s.w,o=i>=s.y&&i<=s.y+s.h+1;return n&&o})}reverseDirection(){this.facing=this.facing===1?-1:1}}function tt(r,t,e,i=-1){return new Ot({type:r,x:t,y:e,facing:i})}function et(r,t,e){return r.x+e<t.x+t.w&&r.x+r.w-e>t.x&&r.y+e<t.y+t.h&&r.y+r.h-e>t.y}function Ht(r){return W||(W=Nt()),W[r]}let W=null;function Nt(){return{rat:Bt(),mouse:Ft(),tank:kt()}}function Bt(){const e=document.createElement("canvas");e.width=40,e.height=14;const i=e.getContext("2d");if(!i)throw new Error("Unable to create rat sprite");const s=o=>{const a=o*20,l="#2f2420",c="#5c4639",d="#7c604b",h="#d8595b",u="#a78176";i.fillStyle=u,i.fillRect(a+1,8,5,1),i.fillRect(a+0,9,3,1),i.fillStyle=l,i.fillRect(a+5,5,11,6),i.fillRect(a+14,4,4,4),i.fillStyle=c,i.fillRect(a+6,6,9,4),i.fillRect(a+14,5,3,2),i.fillStyle=d,i.fillRect(a+8,7,5,2),i.fillStyle=l,i.fillRect(a+15,3,1,1),i.fillStyle=h,i.fillRect(a+16,6,1,1),i.fillStyle=l,o===0?(i.fillRect(a+7,11,2,2),i.fillRect(a+12,10,2,3)):(i.fillRect(a+8,10,2,3),i.fillRect(a+12,11,2,2))};s(0),s(1);const n=new Image;return n.src=e.toDataURL("image/png"),{image:n,frameW:20,frameH:14,frameDuration:.12}}function Ft(){const e=document.createElement("canvas");e.width=32,e.height=12;const i=e.getContext("2d");if(!i)throw new Error("Unable to create mouse sprite");const s=o=>{const a=o*16,l="#493744",c="#8c6f82",d="#d2a8bf",h="#ff8088",u="#cfafba";i.fillStyle=u,i.fillRect(a+0,7,4,1),i.fillStyle=l,i.fillRect(a+4,5,8,4),i.fillRect(a+10,4,3,3),i.fillStyle=c,i.fillRect(a+5,6,6,2),i.fillStyle=d,i.fillRect(a+9,2,2,2),i.fillRect(a+11,2,2,2),i.fillStyle=h,i.fillRect(a+11,5,1,1),i.fillStyle=l,o===0?(i.fillRect(a+5,9,1,2),i.fillRect(a+9,8,1,3)):(i.fillRect(a+6,8,1,3),i.fillRect(a+9,9,1,2))};s(0),s(1);const n=new Image;return n.src=e.toDataURL("image/png"),{image:n,frameW:16,frameH:12,frameDuration:.08}}function kt(){const e=document.createElement("canvas");e.width=44,e.height=32;const i=e.getContext("2d");if(!i)throw new Error("Unable to create tank sprite");const s=(o,a)=>{const l=o*22,c=a?16:0,d="#2d3a48",h="#526475",u="#9caec2",p="#deeffa",m="#6f8397";i.fillStyle=m,i.fillRect(l+1,c+9,5,1),i.fillStyle=d,i.fillRect(l+5,c+6,13,7),i.fillRect(l+15,c+5,4,4),i.fillStyle=h,i.fillRect(l+6,c+7,11,5),i.fillStyle=u,i.fillRect(l+6,c+8,11,2),a&&(i.fillStyle="#263443",i.fillRect(l+11,c+8,1,2),i.fillRect(l+12,c+9,1,1),i.fillRect(l+10,c+9,1,1)),i.fillStyle=p,i.fillRect(l+17,c+7,1,1),i.fillStyle=d,o===0?(i.fillRect(l+7,c+13,2,2),i.fillRect(l+13,c+12,2,3)):(i.fillRect(l+8,c+12,2,3),i.fillRect(l+13,c+13,2,2))};s(0,!1),s(1,!1),s(0,!0),s(1,!0);const n=new Image;return n.src=e.toDataURL("image/png"),{image:n,frameW:22,frameH:16,frameDuration:.14}}const b=320,I=180,it=1200,Yt=900,qt=650,st=170,Wt=.65,nt=1200,ot=700,at=120,rt=120,C=.75,lt=2,X=3,Xt=1,ct=190,Vt=4,Ut=.5,ht=3,jt=6,O=16,dt=6,$t=.1,zt=28,Jt=34,Kt=28,Qt=.7,ut=.3,Zt=-120,te=520,ee=2.5,ft=.45,ie=.2,se=.35,ne=.075,oe=600,yt=30,ae=8,re=12,le="170, 142, 104",ce=1.5,pt=16,mt=40,v=[{x:0,y:164,w:320,h:16},{x:52,y:128,w:72,h:10},{x:160,y:102,w:62,h:10},{x:250,y:138,w:56,h:10}],gt=[{x:78,groundY:128},{x:176,groundY:102},{x:270,groundY:138},{x:236,groundY:138}],he=[{type:"rat",weight:.5},{type:"mouse",weight:.3},{type:"tank",weight:.2}],de=3,St=6,xt=10,ue=2,fe=3,ye=120,pe=22,Tt={x:186,y:88,w:8,h:8,collected:!1},S={x:292,y:132,w:18,h:32};class me{canvas;ctx;input;onGameOver;onLevelComplete;sound;enemies=[];playerSpriteImage;playerAnimations;playerSpriteReady=!1;currentPlayerAnimation="idle";playerAnimationFrameIndex=0;playerAnimationFrameElapsed=0;lastTick=0;nowMs=0;isRunning=!1;lastGroundedTimeMs=-1/0;lastJumpPressedTimeMs=-1/0;previousJumpHeld=!1;debugEnabled=!1;hearts=X;bonesCollected=0;invincibleTimerSec=0;gameState="playing";elapsedSec=0;playerState="normal";digTimerSec=0;activeDigSpotIndex=null;digSpots=[];bones=[];digParticles=[];digEmitTimerSec=0;goldenToy={...Tt};hasGoldenToy=!1;gateHintTimerSec=0;spawnTimerSec=0;pendingRespawnTimers=[];player={x:pt,y:mt,w:16,h:16,vx:0,vy:0,facing:1,grounded:!1,animationTime:0};constructor(t,e,i={}){const s=t.getContext("2d");if(!s)throw new Error("2D context unavailable");this.canvas=t,this.ctx=s,this.input=e,this.onGameOver=i.onGameOver,this.onLevelComplete=i.onLevelComplete,this.sound=i.sound,this.digSpots=this.generateDigSpots("level1"),this.resetEnemyWave();const n=we();this.playerSpriteImage=n.image,this.playerAnimations=n.animations,this.playerSpriteImage.onload=()=>{this.playerSpriteReady=!0},this.ctx.imageSmoothingEnabled=!1,window.addEventListener("keydown",o=>{o.code==="Backslash"&&(this.debugEnabled=!this.debugEnabled)}),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}start(){this.isRunning||(this.isRunning=!0,this.lastTick=performance.now(),requestAnimationFrame(t=>this.loop(t)))}restart(){this.hearts=X,this.bonesCollected=0,this.invincibleTimerSec=0,this.gameState="playing",this.lastGroundedTimeMs=-1/0,this.lastJumpPressedTimeMs=-1/0,this.previousJumpHeld=!1,this.elapsedSec=0,this.playerState="normal",this.digTimerSec=0,this.activeDigSpotIndex=null,this.digEmitTimerSec=0,this.player.x=pt,this.player.y=mt,this.player.vx=0,this.player.vy=0,this.player.facing=1,this.player.grounded=!1,this.player.animationTime=0,this.currentPlayerAnimation="idle",this.playerAnimationFrameIndex=0,this.playerAnimationFrameElapsed=0,this.resetEnemyWave(),this.digSpots=this.generateDigSpots("level1"),this.bones=[],this.digParticles=[],this.goldenToy={...Tt,collected:!1},this.hasGoldenToy=!1,this.gateHintTimerSec=0}isGameOver(){return this.gameState==="gameOver"}isLevelComplete(){return this.gameState==="levelComplete"}loop(t){if(!this.isRunning)return;const e=Math.min((t-this.lastTick)/1e3,1/30);this.lastTick=t,this.nowMs=t,this.update(e),this.render(),this.input.endFrame(),requestAnimationFrame(i=>this.loop(i))}update(t){if(this.gameState!=="playing")return;const e=this.input.state,i=Number(e.right)-Number(e.left),s=this.player.y+this.player.h;if(this.elapsedSec+=t,this.invincibleTimerSec>0&&(this.invincibleTimerSec=Math.max(0,this.invincibleTimerSec-t)),this.gateHintTimerSec>0&&(this.gateHintTimerSec=Math.max(0,this.gateHintTimerSec-t)),this.playerState==="normal"&&this.input.consumeDigPressed()){const n=this.findDigSpotForPlayer();this.player.grounded&&n!==null&&(this.playerState="digging",this.digTimerSec=Ut,this.activeDigSpotIndex=n,this.player.vx=0)}if(this.player.grounded&&(this.lastGroundedTimeMs=this.nowMs),this.playerState==="normal"){this.input.consumeJumpPressed()&&(this.lastJumpPressedTimeMs=this.nowMs),i<0?this.player.facing=-1:i>0&&(this.player.facing=1);const n=this.player.grounded?Yt:qt;i!==0?this.player.vx+=i*n*t:this.player.grounded&&(this.player.vx=wt(this.player.vx,0,nt*t)),this.player.vx=D(this.player.vx,-st,st);const o=this.nowMs-this.lastJumpPressedTimeMs<=rt,a=this.player.grounded||this.nowMs-this.lastGroundedTimeMs<=at;o&&a&&(this.player.vy=-420,this.player.grounded=!1,this.lastJumpPressedTimeMs=-1/0,this.lastGroundedTimeMs=-1/0,this.sound?.playJump()),this.previousJumpHeld&&!e.jumpHeld&&this.player.vy<0&&(this.player.vy*=Wt)}else this.player.grounded&&(this.player.vx=wt(this.player.vx,0,nt*t)),this.emitDigParticlesWhileDigging(t),this.digTimerSec-=t,this.digTimerSec<=0&&this.finishDig();this.player.vy+=it*t,this.player.vy=Math.min(this.player.vy,ot),this.moveHorizontal(t,e),this.moveVertical(t),this.player.grounded=this.checkGrounded(),this.player.grounded&&(this.lastGroundedTimeMs=this.nowMs),this.updateEnemySpawning(t);for(const n of this.enemies)n.update(t,v,it,ot,C);this.handlePlayerEnemyCollision(s),this.updateBonesAndParticles(t),this.handleGoldenToyAndGate(),this.updatePlayerAnimation(t),this.player.animationTime+=t,this.previousJumpHeld=e.jumpHeld}moveHorizontal(t,e){this.player.x+=this.player.vx*t;for(const i of v)x(this.player,i,C)&&(this.tryStepUp(e)||(this.player.vx>0&&this.player.x+this.player.w>i.x?this.player.x=i.x-this.player.w+C:this.player.vx<0&&(this.player.x=i.x+i.w-C),this.player.vx=0))}moveVertical(t){this.player.y+=this.player.vy*t;for(const e of v)x(this.player,e,C)&&(this.player.vy>0?this.player.y=e.y-this.player.h+C:this.player.vy<0&&(this.player.y=e.y+e.h-C),this.player.vy=0)}tryStepUp(t){const e=t.right&&this.player.vx>0||t.left&&this.player.vx<0;if(!this.player.grounded||!e)return!1;const i={x:this.player.x,y:this.player.y-lt,w:this.player.w,h:this.player.h};return v.some(n=>x(i,n,C))?!1:(this.player.y-=lt,!0)}handlePlayerEnemyCollision(t){for(let e=this.enemies.length-1;e>=0;e-=1){const i=this.enemies[e];if(!i.isAlive())continue;const s=i.getBody();if(!x(this.player,s,0))continue;const n=this.player.y+this.player.h;if(this.player.vy>0&&t<=s.y+Vt&&n>=s.y){const c=i.applyStomp();this.player.vy=-189,this.player.grounded=!1,this.lastGroundedTimeMs=-1/0,this.sound?.playStomp(),c==="killed"&&(this.enemies.splice(e,1),this.pendingRespawnTimers.push(this.randomRange(ue,fe)));return}if(this.invincibleTimerSec>0||!i.canDamagePlayer())continue;this.hearts=Math.max(0,this.hearts-1),this.invincibleTimerSec=Xt;const a=this.player.x+this.player.w/2,l=s.x+s.w/2;this.player.vx=a<l?-ct:ct,this.player.vy=-220,this.player.grounded=!1,this.sound?.playHurt(),this.hearts<=0&&(this.gameState="gameOver",this.onGameOver?.());return}}resetEnemyWave(){this.enemies=[],this.pendingRespawnTimers=[],this.spawnTimerSec=this.randomRange(St,xt),this.spawnEnemyIfPossible()}updateEnemySpawning(t){this.spawnTimerSec-=t,this.spawnTimerSec<=0&&(this.spawnEnemyIfPossible(),this.spawnTimerSec=this.randomRange(St,xt));for(let e=this.pendingRespawnTimers.length-1;e>=0;e-=1)this.pendingRespawnTimers[e]-=t,this.pendingRespawnTimers[e]<=0&&(this.spawnEnemyIfPossible()?this.pendingRespawnTimers.splice(e,1):this.pendingRespawnTimers[e]=1)}spawnEnemyIfPossible(){if(this.enemies.length>=de)return!1;const t=this.pickEnemyType(),i=tt(t,0,0).getBody(),s=this.player.x+this.player.w/2,n=[...gt].sort(()=>Math.random()-.5);for(const o of n){const a=o.x,l=o.groundY-i.h-.01,c={x:a,y:l,w:i.w,h:i.h},d=a+c.w/2;if(Math.abs(d-s)<ye||this.enemies.some(g=>{const M=g.getBody(),R=M.x+M.w/2;return Math.abs(R-d)<pe})||v.some(g=>x(c,g,0))||!v.some(g=>{const M=c.x+c.w/2,R=c.y+c.h+2,_=M>=g.x&&M<=g.x+g.w,B=R>=g.y&&R<=g.y+g.h+2;return _&&B}))continue;const m=d>s?-1:1,E=tt(t,c.x,c.y,m);return this.enemies.push(E),this.emitEnemySpawnPoof(E.getBody()),!0}return!1}pickEnemyType(){const t=Math.random();let e=0;for(const i of he)if(e+=i.weight,t<=e)return i.type;return"rat"}randomRange(t,e){return t+Math.random()*(e-t)}emitEnemySpawnPoof(t){const e=Math.floor(this.randomRange(ae,re+1)),i=t.x+t.w/2,s=t.y+t.h-2;for(let n=0;n<e;n+=1){const o=Math.random()*Math.PI*2,a=this.randomRange(22,70),l=Math.random()<.5?2:3,c=this.randomRange(.25,.35);this.pushDigParticle({x:i+Math.cos(o)*2,y:s+Math.sin(o)*1.5,w:l,h:l,vx:D(Math.cos(o)*a,-60,60),vy:D(Math.sin(o)*a-80,-120,-40),lifeSec:c,maxLifeSec:c,colorRgb:le})}}handleGoldenToyAndGate(){if(!this.goldenToy.collected&&x(this.player,this.goldenToy,0)&&(this.goldenToy.collected=!0,this.hasGoldenToy=!0,this.sound?.playGoldenToyPickup(),this.sound?.playGateUnlock()),!!x(this.player,S,0)){if(!this.hasGoldenToy){this.gateHintTimerSec=Math.max(this.gateHintTimerSec,ce);return}this.gameState="levelComplete",this.sound?.playLevelComplete(),this.onLevelComplete?.({bonesCollected:this.bonesCollected,heartsRemaining:this.hearts,timeSec:this.elapsedSec})}}updateBonesAndParticles(t){for(const e of this.bones)e.active&&(e.state==="popping"&&(e.popTimerSec+=t,e.vy+=te*t,e.y+=e.vy*t,e.popTimerSec<ut*.75?e.y=Math.max(e.targetY,e.y):e.y=Math.min(e.settleY,Math.max(e.targetY,e.y)),e.popTimerSec>=ut&&(e.state="idle",e.y=e.settleY,e.vy=0)),e.state==="idle"&&x(this.player,e,0)&&(e.active=!1,this.bonesCollected+=1,this.sound?.playBonePickup()));for(let e=this.digParticles.length-1;e>=0;e-=1){const i=this.digParticles[e];if(i.lifeSec-=t,i.lifeSec<=0){this.digParticles.splice(e,1);continue}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=oe*t}}finishDig(){if(this.playerState="normal",this.sound?.playDig(),this.activeDigSpotIndex===null)return;const t=this.digSpots[this.activeDigSpotIndex];this.activeDigSpotIndex=null,!(!t||t.dug)&&(t.dug=!0,t.hasBone?this.spawnBoneFromSpot(t):this.spawnEmptyDigPuff(t))}spawnBoneFromSpot(t){const s=t.y+t.h,n=s-4,o=s-12,a=o+ee;this.bones.push({x:t.x+(t.w-8)/2,y:n,w:8,h:6,active:!0,vy:Zt,state:"popping",popTimerSec:0,startY:n,targetY:o,settleY:a})}spawnEmptyDigPuff(t){const e=t.x+t.w/2,i=t.y+1,s=3+Math.floor((t.x+t.y)%4);for(let n=0;n<s;n+=1){const o=n-(s-1)/2;this.pushDigParticle({x:e+o*2,y:i,w:3,h:3,vx:o*16,vy:-45-Math.abs(o)*5,lifeSec:ft,maxLifeSec:ft,colorRgb:"120, 78, 42"})}}emitDigParticlesWhileDigging(t){if(this.activeDigSpotIndex===null)return;const e=this.digSpots[this.activeDigSpotIndex];if(e)for(this.digEmitTimerSec-=t;this.digEmitTimerSec<=0;){this.digEmitTimerSec+=ne;const i=1+Math.floor(Math.random()*2);for(let s=0;s<i;s+=1){const n=Math.random()<.5?2:3,o=G(ie,se,Math.random());this.pushDigParticle({x:e.x+e.w*(.25+Math.random()*.5),y:e.y+e.h-1,w:n,h:n,vx:G(-40,40,Math.random()),vy:G(-120,-60,Math.random()),lifeSec:o,maxLifeSec:o,colorRgb:"120, 78, 42"})}}}pushDigParticle(t){this.digParticles.push(t),this.digParticles.length>yt&&this.digParticles.splice(0,this.digParticles.length-yt)}findDigSpotForPlayer(){for(let t=0;t<this.digSpots.length;t+=1){const e=this.digSpots[t];if(!e.dug&&x(this.player,e,0))return t}return null}generateDigSpots(t){const e=Se(),i=Et(t),s=ht+Math.floor(i()*(jt-ht+1)),n=Math.max(e.x+Math.floor(b*$t),e.x+zt),o=e.x+e.w-O-2,a=[];let l=0;for(;a.length<s&&l<300;){l+=1;const c=Math.floor(G(n,o,i())),d=c+O/2;if(gt.some(E=>Math.abs(d-E.x)<Jt)||a.some(E=>Math.abs(d-(E.x+E.w/2))<Kt))continue;const p=e.y-dt,m={x:c,y:p,w:O,h:dt,dug:!1,hasBone:i()<Qt,dirtDecor:xe(`${t}:${c}:${p}`)};ge(m,v)&&a.push(m)}return a}render(){this.ctx.imageSmoothingEnabled=!1,this.ctx.clearRect(0,0,b,I),this.ctx.fillStyle="#8bd3ff",this.ctx.fillRect(0,0,b,I),this.ctx.fillStyle="#669f5d";for(const t of v)this.ctx.fillRect(t.x,t.y,t.w,t.h);this.drawExitGate(),this.drawGoldenToy(),this.drawDigSpots(),this.drawBones(),this.drawDigParticles();for(const t of this.enemies)t.draw(this.ctx);this.drawPlayer(),this.drawHud(),this.gateHintTimerSec>0&&this.drawGateHint(),this.debugEnabled&&this.drawDebug()}drawExitGate(){const t=this.hasGoldenToy,e=.75+Math.sin(this.nowMs*.01)*.25;this.ctx.fillStyle=t?`rgba(76, 178, 89, ${e.toFixed(3)})`:"#6d5f67",this.ctx.fillRect(S.x,S.y,S.w,S.h),this.ctx.fillStyle=t?"#c8f3ce":"#a99ca4";const i=3;for(let s=0;s<i;s+=1){const n=S.x+3+s*4;this.ctx.fillRect(n,S.y+3,2,S.h-6)}this.ctx.strokeStyle="#283040",this.ctx.strokeRect(S.x,S.y,S.w,S.h)}drawGoldenToy(){if(this.goldenToy.collected)return;const t=1+Math.sin(this.nowMs*.012)*.1,e=this.goldenToy.w*t,i=this.goldenToy.h*t,s=this.goldenToy.x-(e-this.goldenToy.w)/2,n=this.goldenToy.y-(i-this.goldenToy.h)/2;this.ctx.fillStyle="#f5cb42",this.ctx.fillRect(s,n,e,i),this.ctx.fillStyle="#fff2b8",this.ctx.fillRect(s+2,n+2,Math.max(1,e-4),Math.max(1,i-4)),this.ctx.strokeStyle="#a87f18",this.ctx.strokeRect(s,n,e,i)}drawDigSpots(){for(let t=0;t<this.digSpots.length;t+=1){const e=this.digSpots[t],i=this.activeDigSpotIndex===t&&this.playerState==="digging";this.ctx.fillStyle=e.dug?"#8b7657":"#56724a",this.ctx.fillRect(e.x,e.y,e.w,e.h),e.dug?(this.ctx.fillStyle="#3f3c34",this.ctx.fillRect(e.x+2,e.y+2,e.w-4,2),this.drawDugSpotDecor(e)):(this.ctx.fillStyle=i?"#d7c086":"#8ca574",this.ctx.fillRect(e.x+2,e.y+1,2,2),this.ctx.fillRect(e.x+e.w-4,e.y+1,2,2)),this.debugEnabled&&(this.ctx.strokeStyle="rgba(255, 255, 0, 0.8)",this.ctx.strokeRect(e.x,e.y,e.w,e.h))}}drawDugSpotDecor(t){const e=["#7f6948","#6f5b3f","#8d7450"];for(const i of t.dirtDecor){const s=t.x+i.xOffset,n=t.y+i.yOffset,o=i.size,a=i.flipX?-1:1;this.ctx.fillStyle=e[i.shadeIndex%e.length],this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.lineTo(s+a*o,n+1),this.ctx.lineTo(s,n+o),this.ctx.closePath(),this.ctx.fill()}}drawBones(){for(const t of this.bones)t.active&&(this.ctx.fillStyle="#ffffff",this.ctx.fillRect(t.x,t.y,t.w,t.h),this.ctx.strokeStyle="#d8d8d8",this.ctx.strokeRect(t.x,t.y,t.w,t.h))}drawDigParticles(){for(const t of this.digParticles){const e=D(t.lifeSec/t.maxLifeSec,0,1);this.ctx.fillStyle=`rgba(${t.colorRgb}, ${e.toFixed(3)})`,this.ctx.fillRect(t.x,t.y,t.w,t.h)}}drawPlayer(){this.ctx.save(),this.invincibleTimerSec>0&&Math.floor(this.nowMs/80)%2===0&&(this.ctx.globalAlpha=.35);const t=this.player.x-4,e=this.player.y-8,i=24,s=24;if(this.player.facing===-1?(this.ctx.translate(t+i,e),this.ctx.scale(-1,1)):this.ctx.translate(t,e),this.playerSpriteReady){const n=this.getCurrentPlayerFrame();this.ctx.drawImage(this.playerSpriteImage,n.x,n.y,n.w,n.h,0,0,i,s)}else this.ctx.fillStyle=this.playerState==="digging"?"#3b4659":"#2f4f6f",this.ctx.fillRect(4,8,this.player.w,this.player.h),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(15,12,2,2);this.ctx.restore()}updatePlayerAnimation(t){const e=this.playerState==="digging"?"digging":this.player.grounded?Math.abs(this.player.vx)>18?"run":"idle":"jump";e!==this.currentPlayerAnimation&&(this.currentPlayerAnimation=e,this.playerAnimationFrameIndex=0,this.playerAnimationFrameElapsed=0);const i=this.playerAnimations[this.currentPlayerAnimation];if(!(i.length<=1))for(this.playerAnimationFrameElapsed+=t;this.playerAnimationFrameElapsed>=i[this.playerAnimationFrameIndex].duration;)this.playerAnimationFrameElapsed-=i[this.playerAnimationFrameIndex].duration,this.playerAnimationFrameIndex<i.length-1?this.playerAnimationFrameIndex+=1:this.playerAnimationFrameIndex=0}getCurrentPlayerFrame(){const t=this.playerAnimations[this.currentPlayerAnimation];return t[this.playerAnimationFrameIndex]??t[0]}drawHud(){this.ctx.fillStyle="rgba(12, 24, 40, 0.72)",this.ctx.fillRect(6,6,174,46),this.ctx.font="10px monospace",this.ctx.fillStyle="#f7f3c5",this.ctx.fillText("HP",11,18);for(let t=0;t<X;t+=1){const e=30+t*16,i=t<this.hearts;this.ctx.fillStyle=i?"#da4f5d":"#4b5968",this.ctx.fillRect(e,10,10,10),this.ctx.strokeStyle="#81252f",this.ctx.strokeRect(e,10,10,10)}this.ctx.fillStyle="#f7f3c5",this.ctx.fillText(`Bones: ${this.bonesCollected}`,11,31),this.ctx.fillText(`Toy: ${this.hasGoldenToy?"1/1":"0/1"}`,11,44)}drawGateHint(){this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(96,8,128,18),this.ctx.fillStyle="#f9e7b8",this.ctx.font="9px monospace",this.ctx.fillText("Find the Golden Toy",105,20)}drawDebug(){const t=Math.max(0,at-(this.nowMs-this.lastGroundedTimeMs)),e=Math.max(0,rt-(this.nowMs-this.lastJumpPressedTimeMs));this.ctx.fillStyle="rgba(0, 0, 0, 0.65)",this.ctx.fillRect(6,56,206,86),this.ctx.fillStyle="#d7f3ff",this.ctx.font="9px monospace",this.ctx.fillText(`GS:${this.gameState} G:${this.player.grounded?1:0} H:${this.hearts} B:${this.bonesCollected}`,10,68),this.ctx.fillText(`Toy:${this.hasGoldenToy?1:0} GateHint:${this.gateHintTimerSec.toFixed(2)}`,10,80),this.ctx.fillText(`State:${this.playerState} DigT:${Math.max(0,this.digTimerSec).toFixed(2)}`,10,92),this.ctx.fillText(`VX:${this.player.vx.toFixed(1)} VY:${this.player.vy.toFixed(1)}`,10,104),this.ctx.fillText(`Coyote:${t.toFixed(0)}ms`,10,116),this.ctx.fillText(`Buffer:${e.toFixed(0)}ms`,10,128)}checkGrounded(){const t={x:this.player.x,y:this.player.y+1,w:this.player.w,h:this.player.h};return v.some(e=>x(t,e,C))}resizeCanvas(){const t=window.innerWidth-24,e=window.innerHeight-150,i=Math.max(1,Math.floor(Math.min(t/b,e/I)));this.canvas.style.width=`${b*i}px`,this.canvas.style.height=`${I*i}px`}}function x(r,t,e){return r.x+e<t.x+t.w&&r.x+r.w-e>t.x&&r.y+e<t.y+t.h&&r.y+r.h-e>t.y}function ge(r,t){const e={x:r.x+2,y:r.y+r.h,w:Math.max(1,r.w-4),h:3};return t.some(s=>s.y<160&&x(r,s,0))?!1:t.some(s=>s.y>=160&&x(e,s,0))}function Se(){let r=v[0];for(const t of v)t.y>r.y&&(r=t);return r}function Et(r){let t=2166136261;for(let e=0;e<r.length;e+=1)t^=r.charCodeAt(e),t=Math.imul(t,16777619);return Te(t>>>0)}function xe(r){const t=Et(r),e=3+Math.floor(t()*3),i=[];for(let s=0;s<e;s+=1){const n=s%2===0;i.push({xOffset:n?1+Math.floor(t()*4):O-2-Math.floor(t()*4),yOffset:1+Math.floor(t()*4),size:2+Math.floor(t()*3),shadeIndex:Math.floor(t()*3),flipX:!n})}return i}function Te(r){return()=>{let t=r+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function D(r,t,e){return Math.min(e,Math.max(t,r))}function G(r,t,e){return r+(t-r)*e}function wt(r,t,e){return Math.abs(t-r)<=e?t:r+Math.sign(t-r)*e}function we(){const i=document.createElement("canvas");i.width=96,i.height=72;const s=i.getContext("2d");if(!s)throw new Error("Unable to create placeholder sprite sheet");const n=(c,d,h)=>{const u=c*24,p=d*24;s.clearRect(u,p,24,24);const m="#1b1513",E="#2a1d1a",g="#3a2a22",M="#5a3e2f",R="#d8bf92",_="#f0dfbe",B="#7f5b38",It=h==="runA"||h==="runB"||h==="runC"||h==="runD",Dt=h==="digA"||h==="digB",Gt=h==="jump",F=h==="idleB",T=u+11,w=p+(F?6:7),f=u+7,y=p+(It?11:12),k=h==="runA"||h==="runD"?-1:h==="runB"||h==="runC"?0:F?-1:0,Y=h==="runC"?-1:0;s.fillStyle=m,s.fillRect(u+3+Y,p+8+k,4,7),s.fillStyle=M,s.fillRect(u+4+Y,p+8+k,3,6),s.fillStyle=R,s.fillRect(u+4+Y,p+8+k,2,2),s.fillStyle=m,s.fillRect(f,y,12,8),s.fillStyle=g,s.fillRect(f+1,y,10,7),s.fillStyle=M,s.fillRect(f+2,y+3,8,4),s.fillStyle=m,s.fillRect(T,w,9,8),s.fillStyle=g,s.fillRect(T+1,w+1,7,6);const Q=F?-1:0;s.fillStyle=m,s.fillRect(T+1,w-2+Q,2,2),s.fillRect(T+6,w-3,2,3),s.fillStyle=R,s.fillRect(T+2,w-1+Q,1,1),s.fillRect(T+6,w-1,1,1),s.fillStyle=E,s.fillRect(T+3,w+2,5,4),s.fillStyle=R,s.fillRect(T+4,w+1,1,1),s.fillRect(T+6,w+1,1,1),s.fillRect(T+6,w+4,2,2),s.fillStyle=_,s.fillRect(T+6,w+3,1,1),s.fillStyle=R,s.fillRect(f+8,y+5,4,3),s.fillStyle=_,s.fillRect(f+9,y+5,2,2),s.fillStyle=m,h==="runA"?(s.fillRect(f+1,y+7,2,2),s.fillRect(f+7,y+6,2,3)):h==="runB"?(s.fillRect(f+2,y+6,2,3),s.fillRect(f+8,y+7,2,2)):h==="runC"?(s.fillRect(f+1,y+6,2,3),s.fillRect(f+8,y+7,2,2)):h==="runD"?(s.fillRect(f+2,y+7,2,2),s.fillRect(f+7,y+6,2,3)):Gt?(s.fillRect(f+2,y+6,2,2),s.fillRect(f+8,y+6,2,2)):Dt?(s.fillRect(f+2,y+7,2,2),s.fillRect(f+8,y+7,2,2),s.fillStyle=B,s.fillRect(u+5,p+20,14,3),h==="digB"&&(s.fillRect(u+4,p+19,2,2),s.fillRect(u+18,p+19,2,2))):(s.fillRect(f+2,y+7,2,2),s.fillRect(f+8,y+7,2,2))};n(0,0,"idleA"),n(1,0,"idleB"),n(2,0,"idleA"),n(3,0,"idleB"),n(0,1,"runA"),n(1,1,"runB"),n(2,1,"runC"),n(3,1,"runD"),n(0,2,"jump"),n(1,2,"digA"),n(2,2,"digB"),n(3,2,"idleA");const o=(c,d,h)=>({x:c*24,y:d*24,w:24,h:24,duration:h}),a={idle:[o(0,0,.16),o(1,0,.16),o(2,0,.16),o(3,0,.16)],run:[o(0,1,.1),o(1,1,.1),o(2,1,.1),o(3,1,.1)],jump:[o(0,2,.2)],digging:[o(1,2,.12),o(2,2,.12)]},l=new Image;return l.src=i.toDataURL("image/png"),{image:l,animations:a}}const vt={ArrowLeft:"left",ArrowRight:"right",ArrowDown:"dig",Space:"jumpHeld"},ve=["left","right","jump","dig"];class Ee{state={left:!1,right:!1,jumpHeld:!1,jumpPressed:!1,dig:!1,digPressed:!1};hasConsumedJump=!1;hasConsumedDig=!1;attachKeyboard(t){t.addEventListener("keydown",e=>{const i=vt[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}if(i==="dig"){this.state.dig||(this.state.digPressed=!0),this.state.dig=!0;return}this.state[i]=!0}}),t.addEventListener("keyup",e=>{const i=vt[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld=!1;return}if(i==="dig"){this.state.dig=!1;return}this.state[i]=!1}})}attachTouchButtons(t){t.forEach(e=>{const i=e.dataset.control;if(!i||!ve.includes(i))return;const s=i,n=a=>{if(a.preventDefault(),s==="jump"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}s==="left"&&(this.state.left=!0),s==="right"&&(this.state.right=!0),s==="dig"&&(this.state.dig||(this.state.digPressed=!0),this.state.dig=!0)},o=a=>{if(a.preventDefault(),s==="jump"){this.state.jumpHeld=!1;return}s==="left"&&(this.state.left=!1),s==="right"&&(this.state.right=!1),s==="dig"&&(this.state.dig=!1)};e.addEventListener("pointerdown",n),e.addEventListener("pointerup",o),e.addEventListener("pointerleave",o),e.addEventListener("pointercancel",o),e.addEventListener("contextmenu",a=>a.preventDefault())})}consumeJumpPressed(){return this.hasConsumedJump||!this.state.jumpPressed?!1:(this.hasConsumedJump=!0,!0)}consumeDigPressed(){return this.hasConsumedDig||!this.state.digPressed?!1:(this.hasConsumedDig=!0,!0)}endFrame(){this.state.jumpPressed=!1,this.state.digPressed=!1,this.hasConsumedJump=!1,this.hasConsumedDig=!1}}const Re=108,U=60/Re,V=U/2,j=8,Ce=8,Me=j*Ce,Ae=.24,be=25,Pe=[[48,52,55],[48,52,55],[45,48,52],[45,48,52],[41,45,48],[41,45,48],[43,47,50],[43,47,50]],_e=[{step:0,note:72,lengthSteps:2},{step:2,note:76,lengthSteps:2},{step:4,note:79,lengthSteps:2},{step:6,note:76,lengthSteps:2},{step:8,note:74,lengthSteps:2},{step:10,note:76,lengthSteps:2},{step:12,note:79,lengthSteps:3},{step:15,note:81,lengthSteps:1},{step:16,note:72,lengthSteps:2},{step:18,note:69,lengthSteps:2},{step:20,note:72,lengthSteps:2},{step:22,note:76,lengthSteps:2},{step:24,note:74,lengthSteps:2},{step:26,note:72,lengthSteps:2},{step:28,note:69,lengthSteps:3},{step:31,note:67,lengthSteps:1},{step:32,note:65,lengthSteps:2},{step:34,note:69,lengthSteps:2},{step:36,note:72,lengthSteps:2},{step:38,note:69,lengthSteps:2},{step:40,note:67,lengthSteps:2},{step:42,note:69,lengthSteps:2},{step:44,note:72,lengthSteps:3},{step:47,note:74,lengthSteps:1},{step:48,note:67,lengthSteps:2},{step:50,note:71,lengthSteps:2},{step:52,note:74,lengthSteps:2},{step:54,note:71,lengthSteps:2},{step:56,note:69,lengthSteps:2},{step:58,note:67,lengthSteps:2},{step:60,note:64,lengthSteps:2},{step:62,note:71,lengthSteps:2}];class Ie{audioContext=null;masterGain=null;sfxGain=null;musicGain=null;melodyDelay=null;melodyFeedback=null;melodyDelayMix=null;enabled=!0;unlockAttached=!1;musicPlaying=!1;schedulerId=null;nextStepTime=0;nextStepIndex=0;constructor(){this.attachUnlockListeners()}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t,this.masterGain&&this.audioContext&&this.masterGain.gain.setValueAtTime(t?.22:0,this.audioContext.currentTime)}async unlock(){this.ensureContext(),this.audioContext&&this.audioContext.state==="suspended"&&await this.audioContext.resume()}startMusic(){this.ensureContext(),!(!this.audioContext||this.musicPlaying)&&(this.musicPlaying=!0,this.nextStepIndex=0,this.nextStepTime=this.audioContext.currentTime+.05,this.schedulerId=window.setInterval(()=>{this.scheduleMusic()},be))}stopMusic(){this.musicPlaying=!1,this.schedulerId!==null&&(window.clearInterval(this.schedulerId),this.schedulerId=null)}playJump(){this.createTone({frequency:500,sweepToFrequency:650,type:"square",duration:.12,volume:.11})}playStomp(){this.createTone({frequency:220,type:"square",duration:.1,volume:.12})}playDig(){this.createTone({frequency:180,sweepToFrequency:120,type:"triangle",duration:.08,volume:.09})}playBonePickup(){this.createTone({frequency:800,type:"square",duration:.1,volume:.1})}playGoldenToyPickup(){const t=this.getNow();this.createTone({frequency:700,type:"square",duration:.15,volume:.1},t),this.createTone({frequency:900,type:"square",duration:.15,volume:.1},t+.16)}playHurt(){this.createTone({frequency:300,sweepToFrequency:100,type:"sawtooth",duration:.2,volume:.12})}playGateUnlock(){this.createTone({frequency:400,sweepToFrequency:600,type:"triangle",duration:.2,volume:.1})}playLevelComplete(){const t=this.getNow();this.createTone({frequency:600,type:"square",duration:.11,volume:.11},t),this.createTone({frequency:800,type:"square",duration:.11,volume:.11},t+.13),this.createTone({frequency:1e3,type:"square",duration:.14,volume:.11},t+.26)}scheduleMusic(){if(!(!this.audioContext||!this.musicPlaying))for(;this.nextStepTime<this.audioContext.currentTime+Ae;)this.scheduleStep(this.nextStepIndex,this.nextStepTime),this.nextStepIndex=(this.nextStepIndex+1)%Me,this.nextStepTime+=V}scheduleStep(t,e){if(!this.audioContext||!this.musicGain)return;const i=Math.floor(t/j),s=t%j,n=Pe[i];s===0&&this.scheduleVoice({frequency:L(n[0]-12),type:"triangle",start:e,duration:U*.95,volume:.07,attack:.008,release:.08,destination:this.musicGain}),s===4&&this.scheduleVoice({frequency:L(n[2]-12),type:"triangle",start:e,duration:U*.9,volume:.06,attack:.008,release:.08,destination:this.musicGain});const a=[0,1,2,1,0,1,2,1][s];this.scheduleVoice({frequency:L(n[a]+12),type:"square",start:e,duration:V*.78,volume:.03,attack:.005,release:.04,destination:this.musicGain});for(const l of _e){if(l.step!==t)continue;const c=l.lengthSteps*V*.92;this.scheduleMelodyVoice(L(l.note),e,c)}}scheduleMelodyVoice(t,e,i){!this.musicGain||!this.melodyDelayMix||(this.scheduleVoice({frequency:t,type:"square",start:e,duration:i,volume:.055,attack:.01,release:.1,destination:this.musicGain}),this.scheduleVoice({frequency:t,type:"square",start:e,duration:i,volume:.02,attack:.01,release:.1,destination:this.melodyDelayMix}))}getNow(){return this.ensureContext(),this.audioContext?this.audioContext.currentTime:0}createTone(t,e){if(this.ensureContext(),!this.audioContext||!this.sfxGain||!this.enabled)return;const i=e??this.audioContext.currentTime,s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.type=t.type,s.frequency.setValueAtTime(t.frequency,i),typeof t.sweepToFrequency=="number"&&s.frequency.linearRampToValueAtTime(t.sweepToFrequency,i+t.duration),n.gain.setValueAtTime(0,i),n.gain.linearRampToValueAtTime(t.volume,i+.01),n.gain.linearRampToValueAtTime(1e-4,i+t.duration),s.connect(n),n.connect(this.sfxGain),s.start(i),s.stop(i+t.duration+.02)}scheduleVoice(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.type=t.type,e.frequency.setValueAtTime(t.frequency,t.start);const s=Math.max(t.start+t.attack,t.start+t.duration-t.release);i.gain.setValueAtTime(0,t.start),i.gain.linearRampToValueAtTime(t.volume,t.start+t.attack),i.gain.setValueAtTime(t.volume,s),i.gain.linearRampToValueAtTime(1e-4,t.start+t.duration),e.connect(i),i.connect(t.destination),e.start(t.start),e.stop(t.start+t.duration+.02)}ensureContext(){if(this.audioContext)return;const t=window.AudioContext||window.webkitAudioContext;t&&(this.audioContext=new t,this.masterGain=this.audioContext.createGain(),this.sfxGain=this.audioContext.createGain(),this.musicGain=this.audioContext.createGain(),this.melodyDelay=this.audioContext.createDelay(.25),this.melodyFeedback=this.audioContext.createGain(),this.melodyDelayMix=this.audioContext.createGain(),this.masterGain.gain.value=this.enabled?.22:0,this.sfxGain.gain.value=1,this.musicGain.gain.value=.49,this.melodyDelay.delayTime.value=.15,this.melodyFeedback.gain.value=.2,this.melodyDelayMix.gain.value=1,this.sfxGain.connect(this.masterGain),this.musicGain.connect(this.masterGain),this.melodyDelayMix.connect(this.melodyDelay),this.melodyDelay.connect(this.melodyFeedback),this.melodyFeedback.connect(this.melodyDelay),this.melodyDelay.connect(this.musicGain),this.masterGain.connect(this.audioContext.destination))}attachUnlockListeners(){if(this.unlockAttached)return;this.unlockAttached=!0;const t=async()=>{await this.unlock(),this.audioContext&&this.audioContext.state==="running"&&(window.removeEventListener("pointerdown",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t))};window.addEventListener("pointerdown",t),window.addEventListener("touchstart",t),window.addEventListener("keydown",t)}}function L(r){return 440*Math.pow(2,(r-69)/12)}const Rt=document.querySelector("#app");if(!Rt)throw new Error("Missing #app container");Rt.innerHTML=`
  <header class="top-bar">
    <h1>Sisu: Guardian of the Garden</h1>
    <button id="soundToggle" type="button" aria-pressed="true">Sound: On</button>
  </header>
  <main class="game-shell">
    <canvas id="gameCanvas" width="320" height="180" aria-label="Game canvas"></canvas>
    <div id="startOverlay" class="start-overlay">
      <div class="start-card">
        <h2>Sisu: Guardian of the Garden</h2>
        <p>Phase 2D Prototype</p>
        <button id="startButton" type="button">Start</button>
      </div>
    </div>
    <div id="gameOverOverlay" class="start-overlay hidden">
      <div class="start-card">
        <h2>Game Over</h2>
        <p>Press R or tap restart.</p>
        <button id="restartButton" type="button">Restart</button>
      </div>
    </div>
    <div id="levelCompleteOverlay" class="start-overlay hidden">
      <div class="start-card">
        <h2>Level Complete!</h2>
        <p id="levelStats">Bones: 0 | Hearts: 0 | Time: 0.0s</p>
        <button id="playAgainButton" type="button">Play Again</button>
        <button id="nextLevelButton" type="button" disabled>Next Level (Soon)</button>
      </div>
    </div>
  </main>
  <footer class="mobile-controls" aria-label="Touch controls">
    <button data-control="left" type="button">Left</button>
    <button data-control="right" type="button">Right</button>
    <button data-control="jump" type="button">Jump</button>
    <button data-control="dig" type="button">Dig</button>
  </footer>
`;const Ct=document.querySelector("#gameCanvas"),Mt=document.querySelector("#startOverlay"),At=document.querySelector("#startButton"),$=document.querySelector("#gameOverOverlay"),bt=document.querySelector("#restartButton"),z=document.querySelector("#levelCompleteOverlay"),Pt=document.querySelector("#levelStats"),_t=document.querySelector("#playAgainButton"),H=document.querySelector("#soundToggle"),De=Array.from(document.querySelectorAll("[data-control]"));if(!Ct||!Mt||!At||!$||!bt||!z||!Pt||!_t||!H)throw new Error("Missing required game UI elements");const J=new Ee;J.attachKeyboard(window);J.attachTouchButtons(De);const A=new Ie,N=new me(Ct,J,{sound:A,onGameOver:()=>{A.stopMusic(),$.classList.remove("hidden")},onLevelComplete:({bonesCollected:r,heartsRemaining:t,timeSec:e})=>{A.stopMusic(),Pt.textContent=`Bones: ${r} | Hearts: ${t} | Time: ${e.toFixed(1)}s`,z.classList.remove("hidden")}}),K=()=>{N.restart(),A.startMusic(),$.classList.add("hidden"),z.classList.add("hidden")};let P=!0;H.addEventListener("click",()=>{A.unlock(),P=!P,A.setEnabled(P),H.textContent=`Sound: ${P?"On":"Off"}`,H.setAttribute("aria-pressed",String(P))});At.addEventListener("click",()=>{A.unlock(),Mt.classList.add("hidden"),N.start(),A.startMusic()});bt.addEventListener("click",K);_t.addEventListener("click",K);window.addEventListener("keydown",r=>{r.code==="KeyR"&&(N.isGameOver()||N.isLevelComplete())&&K()});
