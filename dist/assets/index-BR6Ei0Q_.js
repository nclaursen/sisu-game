(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const rt=14,ot=12,at=56,ht=2.4;class lt{spawnX;spawnY;width;height;speed;respawnDelaySec;x;y;vx;vy;grounded=!1;facing=-1;alive=!0;respawnTimerSec=0;constructor(t){this.spawnX=t.x,this.spawnY=t.y,this.width=t.w??rt,this.height=t.h??ot,this.speed=t.speed??at,this.respawnDelaySec=t.respawnDelaySec??ht,this.x=this.spawnX,this.y=this.spawnY,this.vx=this.speed*this.facing,this.vy=0}update(t,e,i,s,n){if(!this.alive){this.respawnTimerSec-=t,this.respawnTimerSec<=0&&this.respawn();return}this.grounded&&!this.hasGroundAhead(e)&&this.reverseDirection(),this.vx=this.speed*this.facing,this.x+=this.vx*t;let o=!1;for(const a of e)C(this.getBody(),a,n)&&(o=!0,this.vx>0?this.x=a.x-this.width+n:this.vx<0&&(this.x=a.x+a.w-n));o&&(this.reverseDirection(),this.vx=this.speed*this.facing),this.vy=Math.min(this.vy+i*t,s),this.y+=this.vy*t,this.grounded=!1;for(const a of e)C(this.getBody(),a,n)&&(this.vy>0?(this.y=a.y-this.height+n,this.grounded=!0):this.vy<0&&(this.y=a.y+a.h-n),this.vy=0)}draw(t){this.alive&&(t.save(),t.fillStyle="#8b2e3b",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#f8d7db",this.facing===1?t.fillRect(this.x+this.width-3,this.y+3,2,2):t.fillRect(this.x+1,this.y+3,2,2),t.restore())}kill(){this.alive&&(this.alive=!1,this.respawnTimerSec=this.respawnDelaySec,this.vx=0,this.vy=0)}reset(){this.alive=!0,this.respawnTimerSec=0,this.x=this.spawnX,this.y=this.spawnY,this.facing=-1,this.vx=this.speed*this.facing,this.vy=0,this.grounded=!1}isAlive(){return this.alive}getBody(){return{x:this.x,y:this.y,w:this.width,h:this.height}}hasGroundAhead(t){const e=this.facing===1?this.x+this.width+2:this.x-2,i=this.y+this.height+2;return t.some(s=>{const n=e>=s.x&&e<=s.x+s.w,o=i>=s.y&&i<=s.y+s.h+1;return n&&o})}reverseDirection(){this.facing=this.facing===1?-1:1}respawn(){this.alive=!0,this.respawnTimerSec=0,this.x=this.spawnX,this.y=this.spawnY,this.vx=this.speed*this.facing,this.vy=0,this.grounded=!1}}function C(r,t,e){return r.x+e<t.x+t.w&&r.x+r.w-e>t.x&&r.y+e<t.y+t.h&&r.y+r.h-e>t.y}const f=320,y=180,R=1200,ct=900,dt=650,A=170,ft=.65,L=1200,G=700,O=120,H=120,c=.75,N=2,S=3,yt=1,B=190,ut=4,pt=.5,Y=3,gt=6,g=16,F=6,mt=.1,xt=28,vt=34,St=28,Tt=.7,$=.3,wt=-120,Et=520,Mt=2.5,X=.45,_t=.2,bt=.35,Pt=.075,Dt=600,j=30,It=1.5,U=16,J=40,d=[{x:0,y:164,w:320,h:16},{x:52,y:128,w:72,h:10},{x:160,y:102,w:62,h:10},{x:250,y:138,w:56,h:10}],W={x:78,y:116},k={x:186,y:88,w:8,h:8,collected:!1},h={x:292,y:132,w:18,h:32};class Ct{canvas;ctx;input;onGameOver;onLevelComplete;enemy;lastTick=0;nowMs=0;isRunning=!1;lastGroundedTimeMs=-1/0;lastJumpPressedTimeMs=-1/0;previousJumpHeld=!1;debugEnabled=!1;hearts=S;bonesCollected=0;invincibleTimerSec=0;gameState="playing";elapsedSec=0;playerState="normal";digTimerSec=0;activeDigSpotIndex=null;digSpots=[];bones=[];digParticles=[];digEmitTimerSec=0;goldenToy={...k};hasGoldenToy=!1;gateHintTimerSec=0;player={x:U,y:J,w:16,h:16,vx:0,vy:0,facing:1,grounded:!1,animationTime:0};constructor(t,e,i={}){const s=t.getContext("2d");if(!s)throw new Error("2D context unavailable");this.canvas=t,this.ctx=s,this.input=e,this.onGameOver=i.onGameOver,this.onLevelComplete=i.onLevelComplete,this.enemy=new lt(W),this.digSpots=this.generateDigSpots("level1"),this.ctx.imageSmoothingEnabled=!1,window.addEventListener("keydown",n=>{n.code==="Backslash"&&(this.debugEnabled=!this.debugEnabled)}),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}start(){this.isRunning||(this.isRunning=!0,this.lastTick=performance.now(),requestAnimationFrame(t=>this.loop(t)))}restart(){this.hearts=S,this.bonesCollected=0,this.invincibleTimerSec=0,this.gameState="playing",this.lastGroundedTimeMs=-1/0,this.lastJumpPressedTimeMs=-1/0,this.previousJumpHeld=!1,this.elapsedSec=0,this.playerState="normal",this.digTimerSec=0,this.activeDigSpotIndex=null,this.digEmitTimerSec=0,this.player.x=U,this.player.y=J,this.player.vx=0,this.player.vy=0,this.player.facing=1,this.player.grounded=!1,this.player.animationTime=0,this.enemy.reset(),this.digSpots=this.generateDigSpots("level1"),this.bones=[],this.digParticles=[],this.goldenToy={...k,collected:!1},this.hasGoldenToy=!1,this.gateHintTimerSec=0}isGameOver(){return this.gameState==="gameOver"}isLevelComplete(){return this.gameState==="levelComplete"}loop(t){if(!this.isRunning)return;const e=Math.min((t-this.lastTick)/1e3,1/30);this.lastTick=t,this.nowMs=t,this.update(e),this.render(),this.input.endFrame(),requestAnimationFrame(i=>this.loop(i))}update(t){if(this.gameState!=="playing")return;const e=this.input.state,i=Number(e.right)-Number(e.left),s=this.player.y+this.player.h;if(this.elapsedSec+=t,this.invincibleTimerSec>0&&(this.invincibleTimerSec=Math.max(0,this.invincibleTimerSec-t)),this.gateHintTimerSec>0&&(this.gateHintTimerSec=Math.max(0,this.gateHintTimerSec-t)),this.playerState==="normal"&&this.input.consumeDigPressed()){const n=this.findDigSpotForPlayer();this.player.grounded&&n!==null&&(this.playerState="digging",this.digTimerSec=pt,this.activeDigSpotIndex=n,this.player.vx=0)}if(this.player.grounded&&(this.lastGroundedTimeMs=this.nowMs),this.playerState==="normal"){this.input.consumeJumpPressed()&&(this.lastJumpPressedTimeMs=this.nowMs),i<0?this.player.facing=-1:i>0&&(this.player.facing=1);const n=this.player.grounded?ct:dt;i!==0?this.player.vx+=i*n*t:this.player.grounded&&(this.player.vx=V(this.player.vx,0,L*t)),this.player.vx=q(this.player.vx,-A,A);const o=this.nowMs-this.lastJumpPressedTimeMs<=H,a=this.player.grounded||this.nowMs-this.lastGroundedTimeMs<=O;o&&a&&(this.player.vy=-420,this.player.grounded=!1,this.lastJumpPressedTimeMs=-1/0,this.lastGroundedTimeMs=-1/0),this.previousJumpHeld&&!e.jumpHeld&&this.player.vy<0&&(this.player.vy*=ft)}else this.player.grounded&&(this.player.vx=V(this.player.vx,0,L*t)),this.emitDigParticlesWhileDigging(t),this.digTimerSec-=t,this.digTimerSec<=0&&this.finishDig();this.player.vy+=R*t,this.player.vy=Math.min(this.player.vy,G),this.moveHorizontal(t,e),this.moveVertical(t),this.player.grounded=this.checkGrounded(),this.player.grounded&&(this.lastGroundedTimeMs=this.nowMs),this.enemy.update(t,d,R,G,c),this.handlePlayerEnemyCollision(s),this.updateBonesAndParticles(t),this.handleGoldenToyAndGate(),this.player.animationTime+=t,this.previousJumpHeld=e.jumpHeld}moveHorizontal(t,e){this.player.x+=this.player.vx*t;for(const i of d)l(this.player,i,c)&&(this.tryStepUp(e)||(this.player.vx>0&&this.player.x+this.player.w>i.x?this.player.x=i.x-this.player.w+c:this.player.vx<0&&(this.player.x=i.x+i.w-c),this.player.vx=0))}moveVertical(t){this.player.y+=this.player.vy*t;for(const e of d)l(this.player,e,c)&&(this.player.vy>0?this.player.y=e.y-this.player.h+c:this.player.vy<0&&(this.player.y=e.y+e.h-c),this.player.vy=0)}tryStepUp(t){const e=t.right&&this.player.vx>0||t.left&&this.player.vx<0;if(!this.player.grounded||!e)return!1;const i={x:this.player.x,y:this.player.y-N,w:this.player.w,h:this.player.h};return d.some(n=>l(i,n,c))?!1:(this.player.y-=N,!0)}handlePlayerEnemyCollision(t){if(!this.enemy.isAlive())return;const e=this.enemy.getBody();if(!l(this.player,e,0))return;const i=this.player.y+this.player.h;if(this.player.vy>0&&t<=e.y+ut&&i>=e.y){this.enemy.kill(),this.player.vy=-189,this.player.grounded=!1,this.lastGroundedTimeMs=-1/0;return}if(this.invincibleTimerSec>0)return;this.hearts=Math.max(0,this.hearts-1),this.invincibleTimerSec=yt;const n=this.player.x+this.player.w/2,o=e.x+e.w/2;this.player.vx=n<o?-B:B,this.player.vy=-220,this.player.grounded=!1,this.hearts<=0&&(this.gameState="gameOver",this.onGameOver?.())}handleGoldenToyAndGate(){if(!this.goldenToy.collected&&l(this.player,this.goldenToy,0)&&(this.goldenToy.collected=!0,this.hasGoldenToy=!0),!!l(this.player,h,0)){if(!this.hasGoldenToy){this.gateHintTimerSec=Math.max(this.gateHintTimerSec,It);return}this.gameState="levelComplete",this.onLevelComplete?.({bonesCollected:this.bonesCollected,heartsRemaining:this.hearts,timeSec:this.elapsedSec})}}updateBonesAndParticles(t){for(const e of this.bones)e.active&&(e.state==="popping"&&(e.popTimerSec+=t,e.vy+=Et*t,e.y+=e.vy*t,e.popTimerSec<$*.75?e.y=Math.max(e.targetY,e.y):e.y=Math.min(e.settleY,Math.max(e.targetY,e.y)),e.popTimerSec>=$&&(e.state="idle",e.y=e.settleY,e.vy=0)),e.state==="idle"&&l(this.player,e,0)&&(e.active=!1,this.bonesCollected+=1));for(let e=this.digParticles.length-1;e>=0;e-=1){const i=this.digParticles[e];if(i.lifeSec-=t,i.lifeSec<=0){this.digParticles.splice(e,1);continue}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=Dt*t}}finishDig(){if(this.playerState="normal",this.activeDigSpotIndex===null)return;const t=this.digSpots[this.activeDigSpotIndex];this.activeDigSpotIndex=null,!(!t||t.dug)&&(t.dug=!0,t.hasBone?this.spawnBoneFromSpot(t):this.spawnEmptyDigPuff(t))}spawnBoneFromSpot(t){const s=t.y+t.h,n=s-4,o=s-12,a=o+Mt;this.bones.push({x:t.x+(t.w-8)/2,y:n,w:8,h:6,active:!0,vy:wt,state:"popping",popTimerSec:0,startY:n,targetY:o,settleY:a})}spawnEmptyDigPuff(t){const e=t.x+t.w/2,i=t.y+1,s=3+Math.floor((t.x+t.y)%4);for(let n=0;n<s;n+=1){const o=n-(s-1)/2;this.pushDigParticle({x:e+o*2,y:i,w:3,h:3,vx:o*16,vy:-45-Math.abs(o)*5,lifeSec:X,maxLifeSec:X})}}emitDigParticlesWhileDigging(t){if(this.activeDigSpotIndex===null)return;const e=this.digSpots[this.activeDigSpotIndex];if(e)for(this.digEmitTimerSec-=t;this.digEmitTimerSec<=0;){this.digEmitTimerSec+=Pt;const i=1+Math.floor(Math.random()*2);for(let s=0;s<i;s+=1){const n=Math.random()<.5?2:3,o=u(_t,bt,Math.random());this.pushDigParticle({x:e.x+e.w*(.25+Math.random()*.5),y:e.y+e.h-1,w:n,h:n,vx:u(-40,40,Math.random()),vy:u(-120,-60,Math.random()),lifeSec:o,maxLifeSec:o})}}}pushDigParticle(t){this.digParticles.push(t),this.digParticles.length>j&&this.digParticles.splice(0,this.digParticles.length-j)}findDigSpotForPlayer(){for(let t=0;t<this.digSpots.length;t+=1){const e=this.digSpots[t];if(!e.dug&&l(this.player,e,0))return t}return null}generateDigSpots(t){const e=At(),i=K(t),s=Y+Math.floor(i()*(gt-Y+1)),n=Math.max(e.x+Math.floor(f*mt),e.x+xt),o=e.x+e.w-g-2,a=[];let _=0;for(;a.length<s&&_<300;){_+=1;const v=Math.floor(u(n,o,i())),b=v+g/2;if(Math.abs(b-W.x)<vt||a.some(I=>Math.abs(b-(I.x+I.w/2))<St))continue;const P=e.y-F,D={x:v,y:P,w:g,h:F,dug:!1,hasBone:i()<Tt,dirtDecor:Lt(`${t}:${v}:${P}`)};Rt(D,d)&&a.push(D)}return a}render(){this.ctx.imageSmoothingEnabled=!1,this.ctx.clearRect(0,0,f,y),this.ctx.fillStyle="#8bd3ff",this.ctx.fillRect(0,0,f,y),this.ctx.fillStyle="#669f5d";for(const t of d)this.ctx.fillRect(t.x,t.y,t.w,t.h);this.drawExitGate(),this.drawGoldenToy(),this.drawDigSpots(),this.drawBones(),this.drawDigParticles(),this.enemy.draw(this.ctx),this.drawPlayer(),this.drawHud(),this.gateHintTimerSec>0&&this.drawGateHint(),this.debugEnabled&&this.drawDebug()}drawExitGate(){const t=this.hasGoldenToy,e=.75+Math.sin(this.nowMs*.01)*.25;this.ctx.fillStyle=t?`rgba(76, 178, 89, ${e.toFixed(3)})`:"#6d5f67",this.ctx.fillRect(h.x,h.y,h.w,h.h),this.ctx.fillStyle=t?"#c8f3ce":"#a99ca4";const i=3;for(let s=0;s<i;s+=1){const n=h.x+3+s*4;this.ctx.fillRect(n,h.y+3,2,h.h-6)}this.ctx.strokeStyle="#283040",this.ctx.strokeRect(h.x,h.y,h.w,h.h)}drawGoldenToy(){if(this.goldenToy.collected)return;const t=1+Math.sin(this.nowMs*.012)*.1,e=this.goldenToy.w*t,i=this.goldenToy.h*t,s=this.goldenToy.x-(e-this.goldenToy.w)/2,n=this.goldenToy.y-(i-this.goldenToy.h)/2;this.ctx.fillStyle="#f5cb42",this.ctx.fillRect(s,n,e,i),this.ctx.fillStyle="#fff2b8",this.ctx.fillRect(s+2,n+2,Math.max(1,e-4),Math.max(1,i-4)),this.ctx.strokeStyle="#a87f18",this.ctx.strokeRect(s,n,e,i)}drawDigSpots(){for(let t=0;t<this.digSpots.length;t+=1){const e=this.digSpots[t],i=this.activeDigSpotIndex===t&&this.playerState==="digging";this.ctx.fillStyle=e.dug?"#8b7657":"#56724a",this.ctx.fillRect(e.x,e.y,e.w,e.h),e.dug?(this.ctx.fillStyle="#3f3c34",this.ctx.fillRect(e.x+2,e.y+2,e.w-4,2),this.drawDugSpotDecor(e)):(this.ctx.fillStyle=i?"#d7c086":"#8ca574",this.ctx.fillRect(e.x+2,e.y+1,2,2),this.ctx.fillRect(e.x+e.w-4,e.y+1,2,2)),this.debugEnabled&&(this.ctx.strokeStyle="rgba(255, 255, 0, 0.8)",this.ctx.strokeRect(e.x,e.y,e.w,e.h))}}drawDugSpotDecor(t){const e=["#7f6948","#6f5b3f","#8d7450"];for(const i of t.dirtDecor){const s=t.x+i.xOffset,n=t.y+i.yOffset,o=i.size,a=i.flipX?-1:1;this.ctx.fillStyle=e[i.shadeIndex%e.length],this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.lineTo(s+a*o,n+1),this.ctx.lineTo(s,n+o),this.ctx.closePath(),this.ctx.fill()}}drawBones(){for(const t of this.bones)t.active&&(this.ctx.fillStyle="#ffffff",this.ctx.fillRect(t.x,t.y,t.w,t.h),this.ctx.strokeStyle="#d8d8d8",this.ctx.strokeRect(t.x,t.y,t.w,t.h))}drawDigParticles(){for(const t of this.digParticles){const e=q(t.lifeSec/t.maxLifeSec,0,1);this.ctx.fillStyle=`rgba(120, 78, 42, ${e.toFixed(3)})`,this.ctx.fillRect(t.x,t.y,t.w,t.h)}}drawPlayer(){this.ctx.save(),this.invincibleTimerSec>0&&Math.floor(this.nowMs/80)%2===0&&(this.ctx.globalAlpha=.35),this.player.facing===-1?(this.ctx.translate(this.player.x+this.player.w,this.player.y),this.ctx.scale(-1,1)):this.ctx.translate(this.player.x,this.player.y),this.ctx.fillStyle=this.playerState==="digging"?"#3b4659":"#2f4f6f",this.ctx.fillRect(0,0,this.player.w,this.player.h),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(11,4,2,2),this.ctx.restore()}drawHud(){this.ctx.fillStyle="rgba(12, 24, 40, 0.72)",this.ctx.fillRect(6,6,174,46),this.ctx.font="10px monospace",this.ctx.fillStyle="#f7f3c5",this.ctx.fillText("HP",11,18);for(let t=0;t<S;t+=1){const e=30+t*16,i=t<this.hearts;this.ctx.fillStyle=i?"#da4f5d":"#4b5968",this.ctx.fillRect(e,10,10,10),this.ctx.strokeStyle="#81252f",this.ctx.strokeRect(e,10,10,10)}this.ctx.fillStyle="#f7f3c5",this.ctx.fillText(`Bones: ${this.bonesCollected}`,11,31),this.ctx.fillText(`Toy: ${this.hasGoldenToy?"1/1":"0/1"}`,11,44)}drawGateHint(){this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(96,8,128,18),this.ctx.fillStyle="#f9e7b8",this.ctx.font="9px monospace",this.ctx.fillText("Find the Golden Toy",105,20)}drawDebug(){const t=Math.max(0,O-(this.nowMs-this.lastGroundedTimeMs)),e=Math.max(0,H-(this.nowMs-this.lastJumpPressedTimeMs));this.ctx.fillStyle="rgba(0, 0, 0, 0.65)",this.ctx.fillRect(6,56,206,86),this.ctx.fillStyle="#d7f3ff",this.ctx.font="9px monospace",this.ctx.fillText(`GS:${this.gameState} G:${this.player.grounded?1:0} H:${this.hearts} B:${this.bonesCollected}`,10,68),this.ctx.fillText(`Toy:${this.hasGoldenToy?1:0} GateHint:${this.gateHintTimerSec.toFixed(2)}`,10,80),this.ctx.fillText(`State:${this.playerState} DigT:${Math.max(0,this.digTimerSec).toFixed(2)}`,10,92),this.ctx.fillText(`VX:${this.player.vx.toFixed(1)} VY:${this.player.vy.toFixed(1)}`,10,104),this.ctx.fillText(`Coyote:${t.toFixed(0)}ms`,10,116),this.ctx.fillText(`Buffer:${e.toFixed(0)}ms`,10,128)}checkGrounded(){const t={x:this.player.x,y:this.player.y+1,w:this.player.w,h:this.player.h};return d.some(e=>l(t,e,c))}resizeCanvas(){const t=window.innerWidth-24,e=window.innerHeight-150,i=Math.max(1,Math.floor(Math.min(t/f,e/y)));this.canvas.style.width=`${f*i}px`,this.canvas.style.height=`${y*i}px`}}function l(r,t,e){return r.x+e<t.x+t.w&&r.x+r.w-e>t.x&&r.y+e<t.y+t.h&&r.y+r.h-e>t.y}function Rt(r,t){const e={x:r.x+2,y:r.y+r.h,w:Math.max(1,r.w-4),h:3};return t.some(s=>s.y<160&&l(r,s,0))?!1:t.some(s=>s.y>=160&&l(e,s,0))}function At(){let r=d[0];for(const t of d)t.y>r.y&&(r=t);return r}function K(r){let t=2166136261;for(let e=0;e<r.length;e+=1)t^=r.charCodeAt(e),t=Math.imul(t,16777619);return Gt(t>>>0)}function Lt(r){const t=K(r),e=3+Math.floor(t()*3),i=[];for(let s=0;s<e;s+=1){const n=s%2===0;i.push({xOffset:n?1+Math.floor(t()*4):g-2-Math.floor(t()*4),yOffset:1+Math.floor(t()*4),size:2+Math.floor(t()*3),shadeIndex:Math.floor(t()*3),flipX:!n})}return i}function Gt(r){return()=>{let t=r+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function q(r,t,e){return Math.min(e,Math.max(t,r))}function u(r,t,e){return r+(t-r)*e}function V(r,t,e){return Math.abs(t-r)<=e?t:r+Math.sign(t-r)*e}const z={ArrowLeft:"left",ArrowRight:"right",ArrowDown:"dig",Space:"jumpHeld"},Ot=["left","right","jump","dig"];class Ht{state={left:!1,right:!1,jumpHeld:!1,jumpPressed:!1,dig:!1,digPressed:!1};hasConsumedJump=!1;hasConsumedDig=!1;attachKeyboard(t){t.addEventListener("keydown",e=>{const i=z[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}if(i==="dig"){this.state.dig||(this.state.digPressed=!0),this.state.dig=!0;return}this.state[i]=!0}}),t.addEventListener("keyup",e=>{const i=z[e.code];if(i){if(e.preventDefault(),i==="jumpHeld"){this.state.jumpHeld=!1;return}if(i==="dig"){this.state.dig=!1;return}this.state[i]=!1}})}attachTouchButtons(t){t.forEach(e=>{const i=e.dataset.control;if(!i||!Ot.includes(i))return;const s=i,n=a=>{if(a.preventDefault(),s==="jump"){this.state.jumpHeld||(this.state.jumpPressed=!0),this.state.jumpHeld=!0;return}s==="left"&&(this.state.left=!0),s==="right"&&(this.state.right=!0),s==="dig"&&(this.state.dig||(this.state.digPressed=!0),this.state.dig=!0)},o=a=>{if(a.preventDefault(),s==="jump"){this.state.jumpHeld=!1;return}s==="left"&&(this.state.left=!1),s==="right"&&(this.state.right=!1),s==="dig"&&(this.state.dig=!1)};e.addEventListener("pointerdown",n),e.addEventListener("pointerup",o),e.addEventListener("pointerleave",o),e.addEventListener("pointercancel",o),e.addEventListener("contextmenu",a=>a.preventDefault())})}consumeJumpPressed(){return this.hasConsumedJump||!this.state.jumpPressed?!1:(this.hasConsumedJump=!0,!0)}consumeDigPressed(){return this.hasConsumedDig||!this.state.digPressed?!1:(this.hasConsumedDig=!0,!0)}endFrame(){this.state.jumpPressed=!1,this.state.digPressed=!1,this.hasConsumedJump=!1,this.hasConsumedDig=!1}}const Q=document.querySelector("#app");if(!Q)throw new Error("Missing #app container");Q.innerHTML=`
  <header class="top-bar">
    <h1>Sisu: Guardian of the Garden</h1>
    <button id="soundToggle" type="button" aria-pressed="false">Sound: Off</button>
  </header>
  <main class="game-shell">
    <canvas id="gameCanvas" width="320" height="180" aria-label="Game canvas"></canvas>
    <div id="startOverlay" class="start-overlay">
      <div class="start-card">
        <h2>Sisu: Guardian of the Garden</h2>
        <p>Phase 2D Prototype</p>
        <button id="startButton" type="button">Start</button>
      </div>
    </div>
    <div id="gameOverOverlay" class="start-overlay hidden">
      <div class="start-card">
        <h2>Game Over</h2>
        <p>Press R or tap restart.</p>
        <button id="restartButton" type="button">Restart</button>
      </div>
    </div>
    <div id="levelCompleteOverlay" class="start-overlay hidden">
      <div class="start-card">
        <h2>Level Complete!</h2>
        <p id="levelStats">Bones: 0 | Hearts: 0 | Time: 0.0s</p>
        <button id="playAgainButton" type="button">Play Again</button>
        <button id="nextLevelButton" type="button" disabled>Next Level (Soon)</button>
      </div>
    </div>
  </main>
  <footer class="mobile-controls" aria-label="Touch controls">
    <button data-control="left" type="button">Left</button>
    <button data-control="right" type="button">Right</button>
    <button data-control="jump" type="button">Jump</button>
    <button data-control="dig" type="button">Dig</button>
  </footer>
`;const Z=document.querySelector("#gameCanvas"),tt=document.querySelector("#startOverlay"),et=document.querySelector("#startButton"),T=document.querySelector("#gameOverOverlay"),it=document.querySelector("#restartButton"),w=document.querySelector("#levelCompleteOverlay"),st=document.querySelector("#levelStats"),nt=document.querySelector("#playAgainButton"),m=document.querySelector("#soundToggle"),Nt=Array.from(document.querySelectorAll("[data-control]"));if(!Z||!tt||!et||!T||!it||!w||!st||!nt||!m)throw new Error("Missing required game UI elements");const E=new Ht;E.attachKeyboard(window);E.attachTouchButtons(Nt);const x=new Ct(Z,E,{onGameOver:()=>{T.classList.remove("hidden")},onLevelComplete:({bonesCollected:r,heartsRemaining:t,timeSec:e})=>{st.textContent=`Bones: ${r} | Hearts: ${t} | Time: ${e.toFixed(1)}s`,w.classList.remove("hidden")}}),M=()=>{x.restart(),T.classList.add("hidden"),w.classList.add("hidden")};let p=!1;m.addEventListener("click",()=>{p=!p,m.textContent=`Sound: ${p?"On":"Off"}`,m.setAttribute("aria-pressed",String(p))});et.addEventListener("click",()=>{tt.classList.add("hidden"),x.start()});it.addEventListener("click",M);nt.addEventListener("click",M);window.addEventListener("keydown",r=>{r.code==="KeyR"&&(x.isGameOver()||x.isLevelComplete())&&M()});
